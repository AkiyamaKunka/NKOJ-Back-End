#!/usr/bin/env node

const app = require('../app')
const http = require('http')
const fs = require('fs')
const config = require('../config/basic')

const port = 8000

app.set('port', port)

const httpServer = http.createServer(app)
httpServer.listen(port)
httpServer.on('listening', () => console.log('Listening on ' + port))

if (!fs.existsSync(config.DATA_BASE)) fs.mkdirSync(config.DATA_BASE)
if (!fs.existsSync(config.AVATAR_PATH)) fs.mkdirSync(config.AVATAR_PATH)
if (!fs.existsSync(config.PROBLEM_PATH)) fs.mkdirSync(config.PROBLEM_PATH)
if (!fs.existsSync(config.CONTEST_PATH)) fs.mkdirSync(config.CONTEST_PATH)
if (!fs.existsSync(config.SOLUTION_PATH)) fs.mkdirSync(config.SOLUTION_PATH)
if (!fs.existsSync(config.TEMP_PATH)) fs.mkdirSync(config.TEMP_PATH)
if (!fs.existsSync(config.PROBLEM_DATA_PATH)) fs.mkdirSync(config.PROBLEM_DATA_PATH)
if (!fs.existsSync(config.PROBLEM_SPJ_PATH)) fs.mkdirSync(config.PROBLEM_SPJ_PATH)
if (!fs.existsSync(config.PUBLIC_PATH)) fs.mkdirSync(config.PUBLIC_PATH)

require('../lib/chat')
